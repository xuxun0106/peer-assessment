<div class="modal fade">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" ng-click="cancel()" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">{{assessment.courseName+" "+assessment.name}}</h4>
        <br>
        <p>SPA factor indicates the performance of a person compared to the average level of the group.</p>
        <p>SAPA factor indicates a person's self-rating compared to ratings from other members.</p>
      </div>
      <div class="modal-body">
        <div ng-if="user.type==='instructor'" class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Overall performance (weightings applied)</h3>
          </div>
          <div class="penel-body">
            <table class="table table-striped table-hover">
              <thead>
                <th></th>
                <th ng-repeat="scoreReceiver in groupMembers track by $index">{{scoreReceiver}}</th>
              </thead>
              <tbody>
                <tr>
                  <th scope="row">SPA</th>
                  <td ng-repeat="scoreReceiver in groupMembers track by $index">{{overallSPA[scoreReceiver]}}</td>
                </tr>
                <tr>
                  <th scope="row">SAPA</th>
                  <td ng-repeat="scoreReceiver in groupMembers track by $index">{{overallSAPA[scoreReceiver]}}</td>
                </tr>
                <tr>
                  <th scope="row">Flag</th>
                  <td ng-repeat="scoreReceiver in groupMembers track by $index" ng-class="{'red' : flag(overallSAPA[scoreReceiver])}"><span class="glyphicon glyphicon-flag"></span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>


        <div class="panel panel-default" ng-repeat="result in results track by $index" ng-init="questionIndex = $index">
          <div class="panel-heading">
            <h3 class="panel-title">{{assessment.questions[questionIndex].text}}</h3>
          </div>
          <div class="panel-body">
            <div class="" ng-if="assessment.questions[questionIndex].type === 'Single choice' || assessment.questions[questionIndex].type === 'Slider'">
              <table class="table table-striped table-hover">
                <thead>
                  <th></th>
                  <th ng-repeat="scoreGiver in groupMembers track by $index" ng-init="giverIndex = $index" ng-if="user.type==='instructor'">{{scoreGiver}}</th>
                  <th ng-repeat="scoreGiver in groupMembers track by $index" ng-init="giverIndex = $index" ng-if="user.type==='student'">{{isSelf(scoreGiver)}}</th>
                  <th>SPA</th>
                  <th>SAPA</th>
                  <th ng-if="user.type==='instructor'">Flag</th>
                </thead>
                <tbody>
                  <tr ng-repeat="scoreReceiver in groupMembers track by $index" ng-init="receiverIndex = $index">
                    <th scope="row" ng-if="user.type==='instructor'">{{scoreReceiver}}</th>
                    <th scope="row" ng-if="user.type==='student'">{{isSelf(scoreReceiver)}}</th>
                    <td ng-repeat="scoreGiver in groupMembers track by $index">{{rawResults[questionIndex][scoreReceiver][scoreGiver] || '-'}}</td>
                    <td>{{results[questionIndex].spa[scoreReceiver]}}</td>
                    <td>{{results[questionIndex].sapa[scoreReceiver]}}</td>
                    <td ng-if="user.type==='instructor'" ng-class="{'red' : flag(results[questionIndex].sapa[scoreReceiver])}"><span class="glyphicon glyphicon-flag"></span></td>
                  </tr>
                </tbody>
              </table>
              <p class="well" ng-repeat="(key, value) in comments[questionIndex]" ng-if="user.type==='instructor'"><b>{{key}}</b>: {{value}}</p>
              <p class="well" ng-repeat="(key, value) in comments[questionIndex]" ng-if="user.type==='student'"><b>{{isSelf(key)}}</b>: {{value}}</p>
            </div>
            <div class="" ng-if="assessment.questions[questionIndex].type === 'Multiple choice'">
              <table class="table table-striped table-hover">
                <thead>
                  <th></th>
                  <th ng-repeat="option in assessment.questions[questionIndex].options track by $index">{{option}}</th>
                </thead>
                <tbody>
                  <tr ng-repeat="scoreReceiver in groupMembers track by $index" ng-init="receiverIndex = $index">
                    <th scope="row">{{scoreReceiver}}</th>
                    <td ng-repeat="option in assessment.questions[questionIndex].options track by $index">{{results[questionIndex][scoreReceiver][option] || '-'}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="" ng-if="assessment.questions[questionIndex].type === 'Text'">

              <div ng-repeat="scoreReceiver in groupMembers track by $index" ng-init="receiverIndex = $index">
                  <b>{{scoreReceiver}}</b>
                  <p class="well" ng-repeat="(key, value) in results[questionIndex][scoreReceiver]" ng-if="user.type==='instructor'"><b>{{key}}</b>: {{value}}</p>
                  <p class="well" ng-repeat="(key, value) in results[questionIndex][scoreReceiver]" ng-if="user.type==='student'"><b>{{isSelf(key)}}</b>: {{value}}</p>           
              </div>
            </div>
          </div>
        </div>


      </div>
      <div class="modal-footer">
        <button type="button" ng-click="close()" class="btn btn-primary" data-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>
